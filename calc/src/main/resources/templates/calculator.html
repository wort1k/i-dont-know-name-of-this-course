<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è–º–∏</title>
    <link th:href="@{/css/style.css}" rel="stylesheet">
</head>
<body>
<div class="container">
    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç—É–¥–µ–Ω—Ç–µ -->
    <div class="student-info">
        <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç—É–¥–µ–Ω—Ç–µ</h3>
        <div style="display: flex; gap: 30px; flex-wrap: wrap;">
            <div>
                <p><strong>–§–ò–û:</strong> –ö–æ–ª–µ—Å–Ω–µ–≤ –°—Ç–µ–ø–∞–Ω –ê–ª–µ–∫—Å–µ–µ–≤–∏—á</p>
                <p><strong>–ö—É—Ä—Å:</strong> 4</p>
            </div>
            <div>
                <p><strong>–ì—Ä—É–ø–ø–∞:</strong> 4 –ö–¢–°</p>
                <p><strong>–ì–æ–¥:</strong> 2025</p>
            </div>
        </div>
    </div>

    <h1>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è–º–∏</h1>

    <!-- –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º—É–ª—ã -->
    <div class="expression">
            <span class="expression-part" id="display-num1">
                <span th:text="${request.number1 != null ? #strings.replace(request.number1, ',', '.') : '0'}">0</span>
            </span>
        <span class="expression-operator" th:text="${request.op1Symbol}">+</span>
        <span class="expression-brackets">(</span>
        <span class="expression-part" id="display-num2">
                <span th:text="${request.number2 != null ? #strings.replace(request.number2, ',', '.') : '0'}">0</span>
            </span>
        <span class="expression-operator" th:text="${request.op2Symbol}">+</span>
        <span class="expression-part" id="display-num3">
                <span th:text="${request.number3 != null ? #strings.replace(request.number3, ',', '.') : '0'}">0</span>
            </span>
        <span class="expression-brackets">)</span>
        <span class="expression-operator" th:text="${request.op3Symbol}">+</span>
        <span class="expression-part" id="display-num4">
                <span th:text="${request.number4 != null ? #strings.replace(request.number4, ',', '.') : '0'}">0</span>
            </span>
        <span class="expression-operator">=</span>
        <span th:if="${result != null}" class="expression-part" style="background: #d4edda;">
                <span th:text="${result}">0</span>
            </span>
    </div>

    <form th:action="@{/calculate}" method="post" id="calculatorForm">
        <!-- –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞: –ß–∏—Å–ª–æ1 –∏ –æ–ø–µ—Ä–∞—Ü–∏—è -->
        <div class="input-row">
            <div class="input-group">
                <label>–ß–∏—Å–ª–æ 1:</label>
                <input type="text"
                       name="number1"
                       id="number1"
                       th:value="${request.number1}"
                       class="number-input"
                       placeholder="0"
                       onkeydown="handleKeyDown(event, this)"
                       oninput="formatNumberInput(this)"
                       onblur="finalizeFormat(this)">
                <div class="example-number">–ü—Ä–∏–º–µ—Ä: 986 282 584 876.635029</div>
            </div>

            <select name="op1" id="op1" class="operation-select" onchange="updateDisplay()">
                <option th:each="op : ${operations}"
                        th:value="${op}"
                        th:text="${op.symbol}"
                        th:selected="${request.op1 == op}">
                </option>
            </select>

            <span class="expression-brackets" style="font-size: 24px;">(</span>
        </div>

        <!-- –í—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞: –ß–∏—Å–ª–æ2 –∏ –æ–ø–µ—Ä–∞—Ü–∏—è -->
        <div class="input-row">
            <div class="input-group">
                <label>–ß–∏—Å–ª–æ 2:</label>
                <input type="text"
                       name="number2"
                       id="number2"
                       th:value="${request.number2}"
                       class="number-input"
                       placeholder="0"
                       onkeydown="handleKeyDown(event, this)"
                       oninput="formatNumberInput(this)"
                       onblur="finalizeFormat(this)">
                <div class="example-number">–ü—Ä–∏–º–µ—Ä: 123 456.666666</div>
            </div>
        </div>

        <!-- –¢—Ä–µ—Ç—å—è —Å—Ç—Ä–æ–∫–∞: –û–ø–µ—Ä–∞—Ü–∏—è –∏ –ß–∏—Å–ª–æ3 -->
        <div class="input-row">
            <select name="op2" id="op2" class="operation-select" onchange="updateDisplay()">
                <option th:each="op : ${operations}"
                        th:value="${op}"
                        th:text="${op.symbol}"
                        th:selected="${request.op2 == op}">
                </option>
            </select>

            <div class="input-group">
                <label>–ß–∏—Å–ª–æ 3:</label>
                <input type="text"
                       name="number3"
                       id="number3"
                       th:value="${request.number3}"
                       class="number-input"
                       placeholder="0"
                       onkeydown="handleKeyDown(event, this)"
                       oninput="formatNumberInput(this)"
                       onblur="finalizeFormat(this)">
                <div class="example-number">–ü—Ä–∏–º–µ—Ä: 987 654.777777</div>
            </div>

            <span class="expression-brackets" style="font-size: 24px;">)</span>
        </div>

        <!-- –ß–µ—Ç–≤–µ—Ä—Ç–∞—è —Å—Ç—Ä–æ–∫–∞: –û–ø–µ—Ä–∞—Ü–∏—è –∏ –ß–∏—Å–ª–æ4 -->
        <div class="input-row">
            <select name="op3" id="op3" class="operation-select" onchange="updateDisplay()">
                <option th:each="op : ${operations}"
                        th:value="${op}"
                        th:text="${op.symbol}"
                        th:selected="${request.op3 == op}">
                </option>
            </select>

            <div class="input-group">
                <label>–ß–∏—Å–ª–æ 4:</label>
                <input type="text"
                       name="number4"
                       id="number4"
                       th:value="${request.number4}"
                       class="number-input"
                       placeholder="0"
                       onkeydown="handleKeyDown(event, this)"
                       oninput="formatNumberInput(this)"
                       onblur="finalizeFormat(this)">
                <div class="example-number">–ü—Ä–∏–º–µ—Ä: 8.888888</div>
            </div>
        </div>

        <div style="text-align: center; margin: 30px 0;">
            <button type="submit" class="calculate-btn">–í—ã—á–∏—Å–ª–∏—Ç—å</button>
            <button type="button" class="calculate-btn" onclick="clearForm()" style="background: #6c757d; margin-left: 10px;">–û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>
    </form>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
    <div th:if="${result != null}" class="result-section">
        <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã—á–∏—Å–ª–µ–Ω–∏—è:
            <span th:text="${result}" style="color: #007bff; font-family: 'Courier New', monospace; font-weight: bold;"></span>
        </h3>

        <div style="margin: 20px 0;">
            <label><strong>–í—ã–±–æ—Ä –≤–∏–¥–∞ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è:</strong></label>
            <div class="input-row">
                <select name="roundingType" id="roundingType" form="calculatorForm" class="operation-select" style="width: 250px;" onchange="this.form.submit()">
                    <option th:each="rt : ${roundingTypes}"
                            th:value="${rt}"
                            th:text="${rt.description}"
                            th:selected="${request.roundingType == rt}">
                    </option>
                </select>
            </div>
        </div>

        <h3>–û–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–π –¥–æ —Ü–µ–ª—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
            <span th:text="${roundedResult}" style="color: #28a745; font-size: 24px; font-family: 'Courier New', monospace; font-weight: bold;"></span>
        </h3>
    </div>

    <!-- –û—à–∏–±–∫–∞ -->
    <div th:if="${error != null}" class="error">
        <h3 style="color: red;">–û—à–∏–±–∫–∞: <span th:text="${error}"></span></h3>
    </div>

    <!-- –ü–æ–¥—Å–∫–∞–∑–∫–∏ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div class="hints">
        <p><strong>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:</strong></p>
        <ul>
            <li><strong>–§–æ—Ä–º—É–ª–∞:</strong> –ß–∏—Å–ª–æ1 op1 (–ß–∏—Å–ª–æ2 op2 –ß–∏—Å–ª–æ3) op3 –ß–∏—Å–ª–æ4</li>
            <li><strong>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:</strong> (–ß–∏—Å–ª–æ2 op2 –ß–∏—Å–ª–æ3) –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º, –∑–∞—Ç–µ–º —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç * –∏ / –Ω–∞–¥ + –∏ -</li>
            <li><strong>–û–∫—Ä—É–≥–ª–µ–Ω–∏–µ:</strong> –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–∫—Ä—É–≥–ª—è—é—Ç—Å—è –¥–æ 10 –∑–Ω–∞–∫–æ–≤</li>
            <li><strong>–î–∏–∞–ø–∞–∑–æ–Ω:</strong> ¬±1 000 000 000 000.000000</li>
        </ul>

        <p><strong>üéØ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –≤–≤–æ–¥–∞:</strong></p>
        <ul>
            <li>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–≤–æ–¥ —Å –ø—Ä–æ–±–µ–ª–∞–º–∏: <code>1 000 000.50</code></li>
            <li>–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ —Ç–æ—á–∫—É (.), —Ç–∞–∫ –∏ –∑–∞–ø—è—Ç—É—é (,) –∫–∞–∫ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å</li>
            <li>–≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –Ω–æ—Ç–∞—Ü–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä 123e+2) <strong>–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è</strong></li>
            <li>–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —á–∏—Å–ª–∞: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∏–Ω—É—Å –≤ –Ω–∞—á–∞–ª–µ)</li>
            <li>–†–∞–±–æ—Ç–∞—é—Ç Ctrl+C, Ctrl+V, Ctrl+X</li>
            <li>–ü—Ä–∏ –≤–≤–æ–¥–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ —Ç—ã—Å—è—á</li>
        </ul>

        <p><strong>üî¢ –ü—Ä–∏–º–µ—Ä –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</strong></p>
        <div style="background: #e9ecef; padding: 10px; border-radius: 5px; font-family: 'Courier New', monospace;">
            986 282 584 876.635029 - (123 456.666666 * 987 654.777777) - 8.888888
        </div>
    </div>
</div>

<script>
    // –•—Ä–∞–Ω–∏–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∫—É—Ä—Å–æ—Ä–∞
    let lastCursorPos = 0;

    function handleKeyDown(event, input) {
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∫—É—Ä—Å–æ—Ä–∞
    lastCursorPos = input.selectionStart;

    // –†–∞–∑—Ä–µ—à–∞–µ–º –≤—Å–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Å Ctrl
    if (event.ctrlKey || event.metaKey) {
        // –†–∞–∑—Ä–µ—à–∞–µ–º Ctrl+C, Ctrl+V, Ctrl+X, Ctrl+A, Ctrl+Z –∏ –¥—Ä—É–≥–∏–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
        const ctrlCombinations = ['c', 'v', 'x', 'a', 'z', 'y', 's'];
        if (ctrlCombinations.includes(event.key.toLowerCase())) {
            return true; // –†–∞–∑—Ä–µ—à–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞
        }
    }

    // –†–∞–∑—Ä–µ—à–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–ª–∞–≤–∏—à–∏ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∫–ª–∞–≤–∏—à–∏
    const navigationKeys = [
        'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown',
        'Home', 'End', 'Delete', 'Backspace', 'Tab',
        'Enter', 'Escape', 'PageUp', 'PageDown',
        'F1', 'F2', 'F3', 'F4', 'F5', 'F6', 'F7', 'F8', 'F9', 'F10', 'F11', 'F12'
    ];

    if (navigationKeys.includes(event.key)) {
        return true;
    }

    // –†–∞–∑—Ä–µ—à–∞–µ–º —Å–æ—á–µ—Ç–∞–Ω–∏—è –∫–ª–∞–≤–∏—à —Å Shift
    if (event.shiftKey) {
        // –†–∞–∑—Ä–µ—à–∞–µ–º Shift+Tab –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –Ω–∞–∑–∞–¥
        if (event.key === 'Tab') {
            return true;
        }
        // –†–∞–∑—Ä–µ—à–∞–µ–º –¥—Ä—É–≥–∏–µ Shift –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
        return true;
    }

    // –†–∞–∑—Ä–µ—à–∞–µ–º —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã, —Ç–æ—á–∫—É, –∑–∞–ø—è—Ç—É—é, –º–∏–Ω—É—Å –∏ –ø—Ä–æ–±–µ–ª
    const allowedKeys = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9',
                        '.', ',', '-', ' '];

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∫–ª–∞–≤–∏—à–∞ —Ü–∏—Ñ—Ä–æ–π (–±–µ–∑ Shift)
    const isNumber = event.key >= '0' && event.key <= '9' && !event.shiftKey;

    if (!allowedKeys.includes(event.key) && !isNumber) {
        event.preventDefault();
        return false;
    }

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    setTimeout(() => {
        formatNumberInput(input);
    }, 10);
}

    function formatNumberInput(input) {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏ –ø–æ–∑–∏—Ü–∏—é –∫—É—Ä—Å–æ—Ä–∞
        let value = input.value;
        let cursorPos = input.selectionStart;

        // –ó–∞–º–µ–Ω—è–µ–º –∑–∞–ø—è—Ç—É—é –Ω–∞ —Ç–æ—á–∫—É
        value = value.replace(/,/g, '.');

        // –£–¥–∞–ª—è–µ–º –≤—Å–µ –Ω–µ—Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
        value = value.replace(/[^\d.\-\s]/g, '');

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Å–æ–≤
        let minusCount = (value.match(/-/g) || []).length;
        if (minusCount > 1) {
            // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π –º–∏–Ω—É—Å
            value = '-' + value.replace(/-/g, '');
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–æ—á–µ–∫
        let dotCount = (value.match(/\./g) || []).length;
        if (dotCount > 1) {
            // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é —Ç–æ—á–∫—É –∏ –≤—Å–µ —á—Ç–æ –ø–æ—Å–ª–µ –Ω–µ–µ
            let parts = value.split('.');
            value = parts[0] + '.' + parts.slice(1).join('');
        }

        // –ó–∞–ø—Ä–µ—â–∞–µ–º —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—É—é –Ω–æ—Ç–∞—Ü–∏—é
        if (value.includes('e') || value.includes('E')) {
            value = value.replace(/[eE]/g, '');
            showTempMessage('–≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –Ω–æ—Ç–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —á–∏—Å–ª–æ —Å –ø—Ä–æ–±–µ–ª–∞–º–∏
        let formatted = formatWithSpaces(value);
        input.value = formatted;

        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Ñ–æ—Ä–º—É–ª–µ
        updateDisplay();

        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –∫—É—Ä—Å–æ—Ä–∞ —Å —É—á–µ—Ç–æ–º –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–µ–ª–æ–≤
        setTimeout(() => {
            let newCursorPos = calculateNewCursorPos(cursorPos, value, formatted);
            input.setSelectionRange(newCursorPos, newCursorPos);
        }, 0);
    }

    function calculateNewCursorPos(oldPos, oldValue, newValue) {
        if (oldPos === 0) return 0;

        // –°—á–∏—Ç–∞–µ–º —Å–∫–æ–ª—å–∫–æ –Ω–µ—Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ –±—ã–ª–æ –¥–æ –ø–æ–∑–∏—Ü–∏–∏ –∫—É—Ä—Å–æ—Ä–∞ –≤ —Å—Ç–∞—Ä–æ–º –∑–Ω–∞—á–µ–Ω–∏–∏
        let nonDigitCountBefore = 0;
        for (let i = 0; i < Math.min(oldPos, oldValue.length); i++) {
            if (!/\d/.test(oldValue[i])) {
                nonDigitCountBefore++;
            }
        }

        // –¶–∏—Ñ—Ä –¥–æ –ø–æ–∑–∏—Ü–∏–∏ –∫—É—Ä—Å–æ—Ä–∞
        let digitsBefore = oldPos - nonDigitCountBefore;

        // –ù–∞—Ö–æ–¥–∏–º –ø–æ–∑–∏—Ü–∏—é –≤ –Ω–æ–≤–æ–º –∑–Ω–∞—á–µ–Ω–∏–∏
        let newPos = 0;
        let digitsFound = 0;

        for (let i = 0; i < newValue.length; i++) {
            if (digitsFound >= digitsBefore) {
                break;
            }
            if (/\d/.test(newValue[i])) {
                digitsFound++;
            }
            newPos++;
        }

        return newPos;
    }

    function formatWithSpaces(numberStr) {
        if (!numberStr) return '';

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∑–Ω–∞–∫
        let sign = '';
        if (numberStr.startsWith('-')) {
            sign = '-';
            numberStr = numberStr.substring(1);
        }

        // –†–∞–∑–¥–µ–ª—è–µ–º —Ü–µ–ª—É—é –∏ –¥—Ä–æ–±–Ω—É—é —á–∞—Å—Ç–∏
        let parts = numberStr.split('.');
        let integerPart = parts[0].replace(/\D/g, '');
        let decimalPart = parts.length > 1 ? '.' + parts[1].replace(/\D/g, '') : '';

        // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–±–µ–ª—ã –∫–∞–∫ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ —Ç—ã—Å—è—á
        if (integerPart.length > 3) {
            let formattedInteger = '';
            let count = 0;

            for (let i = integerPart.length - 1; i >= 0; i--) {
                if (count > 0 && count % 3 === 0) {
                    formattedInteger = ' ' + formattedInteger;
                }
                formattedInteger = integerPart[i] + formattedInteger;
                count++;
            }
            integerPart = formattedInteger;
        }

        return sign + integerPart + decimalPart;
    }

    function finalizeFormat(input) {
        // –£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã –≤ –Ω–∞—á–∞–ª–µ –∏ –∫–æ–Ω—Ü–µ
        input.value = input.value.trim();

        // –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—É—Å—Ç–æ–µ, —Å—Ç–∞–≤–∏–º 0
        if (!input.value || input.value === '-' || input.value === '.') {
            input.value = '0';
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        updateDisplay();
    }

    function updateDisplay() {
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Ñ–æ—Ä–º—É–ª–µ
        document.getElementById('display-num1').textContent =
            document.getElementById('number1').value.replace(/,/g, '.') || '0';
        document.getElementById('display-num2').textContent =
            document.getElementById('number2').value.replace(/,/g, '.') || '0';
        document.getElementById('display-num3').textContent =
            document.getElementById('number3').value.replace(/,/g, '.') || '0';
        document.getElementById('display-num4').textContent =
            document.getElementById('number4').value.replace(/,/g, '.') || '0';

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∏–º–≤–æ–ª—ã –æ–ø–µ—Ä–∞—Ü–∏–π
        document.querySelectorAll('.expression-operator')[0].textContent =
            document.getElementById('op1').options[document.getElementById('op1').selectedIndex].text;
        document.querySelectorAll('.expression-operator')[1].textContent =
            document.getElementById('op2').options[document.getElementById('op2').selectedIndex].text;
        document.querySelectorAll('.expression-operator')[2].textContent =
            document.getElementById('op3').options[document.getElementById('op3').selectedIndex].text;
    }

    function clearForm() {
        // –û—á–∏—â–∞–µ–º –≤—Å–µ –ø–æ–ª—è
        document.getElementById('number1').value = '0';
        document.getElementById('number2').value = '0';
        document.getElementById('number3').value = '0';
        document.getElementById('number4').value = '0';

        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞ —Å–ª–æ–∂–µ–Ω–∏–µ
        document.getElementById('op1').selectedIndex = 0;
        document.getElementById('op2').selectedIndex = 0;
        document.getElementById('op3').selectedIndex = 0;

        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –Ω–∞ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ
        document.getElementById('roundingType').selectedIndex = 0;

        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        updateDisplay();

        // –§–æ–∫—É—Å –Ω–∞ –ø–µ—Ä–≤–æ–µ –ø–æ–ª–µ
        document.getElementById('number1').focus();
        document.getElementById('number1').select();
    }

    function showTempMessage(message) {
        const tempMsg = document.createElement('div');
        tempMsg.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: #ff4444;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            font-family: Arial, sans-serif;
        `;
        tempMsg.textContent = message;
        document.body.appendChild(tempMsg);

        setTimeout(() => {
            if (tempMsg.parentNode) {
                document.body.removeChild(tempMsg);
            }
        }, 3000);
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    document.addEventListener('DOMContentLoaded', function() {
        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
        document.querySelectorAll('.number-input').forEach(input => {
            if (input.value && input.value !== '0') {
                formatNumberInput(input);
            }
        });

        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ñ–æ—Ä–º—É–ª—ã
        updateDisplay();

        // –§–æ–∫—É—Å –Ω–∞ –ø–µ—Ä–≤–æ–µ –ø–æ–ª–µ –µ—Å–ª–∏ –æ–Ω–æ –ø—É—Å—Ç–æ–µ
        const firstInput = document.getElementById('number1');
        if (firstInput && (!firstInput.value || firstInput.value === '0')) {
            firstInput.focus();
        }
    });

    // –ü—Ä–∏–º–µ—Ä –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
    function fillExample() {
        document.getElementById('number1').value = '986 282 584 876.635029';
        document.getElementById('number2').value = '123 456.666666';
        document.getElementById('number3').value = '987 654.777777';
        document.getElementById('number4').value = '8.888888';

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–ø–µ—Ä–∞—Ü–∏–∏: - * -
        document.getElementById('op1').value = 'SUBTRACT';
        document.getElementById('op2').value = 'MULTIPLY';
        document.getElementById('op3').value = 'SUBTRACT';

        updateDisplay();
        formatNumberInput(document.getElementById('number1'));
        formatNumberInput(document.getElementById('number2'));
        formatNumberInput(document.getElementById('number3'));
        formatNumberInput(document.getElementById('number4'));
    }
</script>

<!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) -->
<div style="position: fixed; bottom: 20px; right: 20px;">
    <button onclick="fillExample()" style="
            background: #17a2b8;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        ">
        –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–∏–º–µ—Ä
    </button>
</div>
</body>
</html>